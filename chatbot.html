 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Argo Float Assistant</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      /* Light Theme (Default: White & Black) */
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --border-light: #dee2e6;
      --user-bubble-bg: #000000;
      --user-bubble-text: #ffffff;
      --bot-bubble-bg: #f8f9fa;
      --bot-bubble-text: #212529;
      --input-bg: #ffffff;
      --accent-primary: #000000;
      --danger-color: #dc3545;
      --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.12);
    }

    .night-theme {
      /* Dark Theme (Black & White) */
      --bg-primary: #000000;
      --bg-secondary: #111111;
      --text-primary: #ffffff;
      --text-secondary: #adb5bd;
      --border-light: #2d3436;
      --user-bubble-bg: #ffffff;
      --user-bubble-text: #000000;
      --bot-bubble-bg: #1a1a1a;
      --bot-bubble-text: #ffffff;
      --input-bg: #111111;
      --accent-primary: #ffffff;
      --shadow-soft: 0 2px 8px rgba(255, 255, 255, 0.05);
      --shadow-medium: 0 4px 16px rgba(255, 255, 255, 0.08);
    }

    body, html {
      height: 100%;
      margin: 0;
      font-family: 'Inter', sans-serif;
      overflow: hidden;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      transition: background-color 0.25s ease, color 0.25s ease;
    }

    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      background-color: var(--bg-primary);
      position: relative;
    }

    /* --- Welcome Screen --- */
    .welcome-screen { display:flex; justify-content:center; align-items:center; flex-direction:column; position:absolute; inset:0; z-index:20; transition:opacity .4s ease, visibility .4s; pointer-events:none; }
    .welcome-screen.hidden { opacity:0; visibility:hidden; }
    .welcome-screen h1 { font-size:2rem; margin:0; color:var(--text-secondary); font-weight:400; }
    .prompt-suggestions { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; pointer-events:auto; margin-top:24px; }
    .prompt-suggestions button { background:var(--bg-secondary); border:1px solid var(--border-light); color:var(--text-primary); padding:10px 14px; border-radius:8px; cursor:pointer; }

    /* --- Header --- */
    .header { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; border-bottom:1px solid var(--border-light); background:var(--bg-primary); z-index:15; }
    .logo-section { display:flex; gap:12px; align-items:center; }
    .logo { width:40px; height:40px; border-radius:50%; background:var(--accent-primary); color:var(--user-bubble-text); display:flex; align-items:center; justify-content:center; font-weight:600; }
    .brand-name { font-weight:600; font-size:1.1rem; color:var(--text-primary); }
    .controls { display:flex; gap:10px; align-items:center; }
    .icon-btn { background:var(--bg-secondary); border:1px solid var(--border-light); padding:8px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; }
    .icon-btn svg { width:20px; height:20px; stroke:var(--text-primary); }

    /* --- Side Menu Styles --- */
    .side-menu {
      position: fixed;
      top: 0;
      left: -300px;
      width: 280px;
      height: 100%;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-light);
      transition: left 0.35s ease-in-out;
      z-index: 30;
      box-shadow: var(--shadow-medium);
      display: flex;
      flex-direction: column;
    }
    .side-menu.open { left: 0; }
    .side-menu-header { padding: 20px 24px; border-bottom: 1px solid var(--border-light); margin-top: 25px; text-align: center; }
    .side-menu-header h2 { margin: 0; color: var(--text-primary); font-size: 1.5rem; font-weight: 600; }
    .side-menu ul { list-style: none; padding: 16px; margin: 0; flex-grow: 1; display: flex; flex-direction: column; }
    .side-menu li a { display: flex; align-items: center; gap: 16px; padding: 12px 16px; margin-bottom: 8px; color: var(--text-secondary); text-decoration: none; font-weight: 500; border-radius: 8px; transition: background-color 0.2s ease, color 0.2s ease; }
    .side-menu li a svg { width: 22px; height: 22px; fill: currentColor; }
    .side-menu li a:hover, .side-menu li a.active { background: var(--accent-primary); color: var(--user-bubble-text); }
    .bottom-link-start { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-light); }

    /* --- Messages --- */
    .message-area { flex-grow:1; overflow:auto; padding: 24px 18px 120px 18px; display:flex; flex-direction:column; gap:16px; }
    .message-bubble { max-width:72%; padding:12px 16px; border-radius:14px; box-shadow:var(--shadow-soft); line-height:1.5; word-wrap:break-word; position: relative; }
    .message-bubble.bot { background:var(--bot-bubble-bg); color:var(--bot-bubble-text); align-self:flex-start; border:1px solid var(--border-light); }
    .message-bubble.user { background:var(--user-bubble-bg); color:var(--user-bubble-text); align-self:flex-end; }
    .message-bubble .cursor { display:inline-block; width:2px; height:1.1em; background:var(--text-primary); vertical-align:middle; animation:blink 1s step-end infinite; }
    @keyframes blink { from,to{background:transparent;} 50%{background:var(--text-primary);} }
    .typing-indicator { display:flex; gap:6px; align-items:center; }
    .typing-indicator span { width:8px; height:8px; border-radius:50%; background:var(--text-secondary); animation:bounce 1.4s infinite; }
    .typing-indicator span:nth-child(1){ animation-delay:-0.32s; } .typing-indicator span:nth-child(2){ animation-delay:-0.16s; }
    @keyframes bounce { 0%,80%,100%{transform:scale(0);} 40%{transform:scale(1);} }

    .copy-btn { position:absolute; bottom:8px; right:8px; background:var(--bg-secondary); border:1px solid var(--border-light); border-radius:6px; width:28px; height:28px; cursor:pointer; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); opacity:0; transition:opacity .2s; }
    .message-bubble.bot:hover .copy-btn { opacity:1; }
    .copy-btn svg { width:16px; height:16px; }

    /* --- Input --- */
    .input-area { position:fixed; left:0; right:0; bottom:18px; display:flex; justify-content:center; z-index:20; }
    .input-wrapper { display:flex; align-items:center; gap:8px; width:100%; max-width:720px; padding:10px 14px; background:var(--input-bg); border-radius:12px; border:1px solid var(--border-light); box-shadow:var(--shadow-medium); }
    #chat-input { flex:1; border:none; outline:none; font-size:15px; background:transparent; color:var(--text-primary); }
    #chat-input::placeholder{ color:var(--text-secondary); }
    .input-actions { display:flex; gap:8px; align-items:center; }

    /* --- UPDATED Input Button Styles --- */
    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary); /* Default icon color */
      transition: transform 0.2s ease, color 0.2s ease;
    }
    .action-btn:hover {
      color: var(--text-primary); /* Darken icon on hover */
      transform: scale(1.1);
    }
    .action-btn.hidden { display: none; }
    .action-btn svg {
      width: 24px;
      height: 24px;
      fill: currentColor; /* Use the button's color for the SVG */
    }
    
    /* Specific button styles */
    #send-btn { color: var(--accent-primary); }
    #send-btn svg { width: 28px; height: 28px; }

    #mic-btn.listening { color: var(--danger-color); }
    #stop-btn { color: var(--danger-color); }
    
    /* Boat/send animations */
    @keyframes boat-thinking { 0%{ transform:translateX(0) rotate(-3deg);} 50%{ transform:translateX(-8px) rotate(3deg);} 100%{ transform:translateX(0) rotate(-3deg);} }
    @keyframes boat-sail-away { 0%{ transform:translateX(0) scale(1) rotate(0); opacity:1;} 100%{ transform:translateX(140px) scale(0.4) rotate(10deg); opacity:0;} }
    #send-btn.thinking svg { animation:boat-thinking 1.2s ease-in-out infinite; }
    #send-btn.sailed-away svg { animation:boat-sail-away 1.1s ease-in forwards; }

    /* Responsive */
    @media (max-width:600px){ .welcome-screen h1{ font-size:1.6rem;} .input-wrapper{ padding:8px 10px; } }
  </style>
</head>
<body>

<div class="chat-container" id="chat-container">

    <div class="welcome-screen" id="welcome-screen">
        <h1>Welcome to Argo Float Chatbot</h1>
        <div class="prompt-suggestions" id="prompt-suggestions">
            <button type="button">Tell me about bioluminescence</button>
            <button type="button">What is the Great Pacific Garbage Patch?</button>
            <button type="button">Explain ocean tides</button>
        </div>
    </div>

    <header class="header">
        <div class="logo-section">
            <div class="logo">AF</div>
            <div class="brand-name">Argo Float</div>
        </div>
        <div class="controls">
            <button class="icon-btn" id="theme-toggle" title="Toggle theme">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
            </button>
            <button class="icon-btn" id="menu-toggle" title="Menu">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M3 12h18M3 6h18M3 18h18" /></svg>
            </button>
        </div>
    </header>

    <nav class="side-menu" id="side-menu">
        <div class="side-menu-header"><h2>ARGO Menu</h2></div>
        <ul>
            <li><a href="graph.html" class="active"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6h-6z"></path></svg>Graphs</a></li>
            <li><a href="heatmap.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 2v4h2V2h-2zm4.79 3.21l-2.83 2.83 1.41 1.41 2.83-2.83-1.41-1.41zM11 22v-4h2v4h-2zm3.38-2.88l-1.41-1.41 2.83-2.83 1.41 1.41-2.83 2.83zM4.93 6.34L6.34 4.93l2.83 2.83-1.41 1.41L4.93 6.34zm12.73 12.73l-1.41-1.41-2.83 2.83 1.41 1.41 2.83-2.83zM2 11h4v2H2v-2zm18 0h-4v2h4v-2z"></path></svg>Heat Maps</a></li>
            <li><a href="locator.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg>Locator</a></li>
            <li><a href="ocean.html"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.95 9.61c-1-4.8-5.32-8.35-10.27-8.6A11 11 0 00.5 11.2a10.91 10.91 0 008.11 10.7c4.2.82 8.3-1.43 10.2-5.06 1.1-2.1.8-4.6-.86-6.23zm-10.06 8.52c-3.23 0-5.85-2.63-5.85-5.85s2.62-5.85 5.85-5.85c1.76 0 3.35.78 4.45 2.05l-1.41 1.41c-.73-.86-1.76-1.4-2.9-1.4a4.35 4.35 0 000 8.7c1.43 0 2.68-.7 3.47-1.74l1.42 1.41c-1.1 1.45-2.83 2.33-4.63 2.33z"></path></svg>Ocean Currents</a></li>
            
            <li class="bottom-link-start"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg>Upgrade to Pro</a></li>
            <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4z"></path></svg>Sign In</a></li>
        </ul>
    </nav>

    <main class="message-area" id="message-area"></main>

    <div class="input-area">
        <div class="input-wrapper">
            <input id="chat-input" type="text" placeholder="Type your message..." autocomplete="off" />
            <div class="input-actions">
                <button class="action-btn hidden" id="stop-btn" title="Stop generating" aria-label="Stop">
                    <svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>
                </button>
                
                <button class="action-btn" id="mic-btn" aria-label="Start voice input">
                    <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                </button>

                <button class="action-btn" id="send-btn" title="Send message" aria-label="Send">
                    <svg id="boat-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.4,20.3l17.2-8.3c0.4-0.2,0.4-0.8,0-1L3.4,2.7C3,2.5,2.5,2.8,2.6,3.3l2.8,10.2c0.1,0.2,0.1,0.5,0,0.7L2.6,21.7 C2.5,22.2,3,22.5,3.4,20.3z M6,12.5h8v-1H6V12.5z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Your JavaScript remains the same as it correctly handles the logic already!
document.addEventListener('DOMContentLoaded', () => {
    const chatContainer = document.getElementById('chat-container');
    const messageArea = document.getElementById('message-area');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const micBtn = document.getElementById('mic-btn');
    const stopBtn = document.getElementById('stop-btn');
    const welcomeScreen = document.getElementById('welcome-screen');
    const menuToggle = document.getElementById('menu-toggle');
    const sideMenu = document.getElementById('side-menu');
    const promptContainer = document.getElementById('prompt-suggestions');
    const themeToggle = document.getElementById('theme-toggle');

    let hasChatStarted = false;
    let typingInterval = null;

    const setAutoNight = () => {
        const hour = new Date().getHours();
        if (localStorage.getItem('theme') === 'dark' || (hour < 6 || hour > 19)) {
            chatContainer.classList.add('night-theme');
        }
    };
    setAutoNight();

    const addCopyButton = (bubble) => {
        if (bubble.querySelector('.copy-btn')) return;
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.title = 'Copy text';
        const copyIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
        const checkIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
        copyBtn.innerHTML = copyIcon;
        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(bubble.textContent).then(() => {
                copyBtn.innerHTML = checkIcon;
                setTimeout(() => { copyBtn.innerHTML = copyIcon; }, 1500);
            });
        });
        bubble.appendChild(copyBtn);
    };

    const stopTyping = (isFinished = false, bubble = null) => {
        if (typingInterval) clearInterval(typingInterval);
        typingInterval = null;
        const currentBubble = bubble || messageArea.querySelector('.message-bubble.bot:last-child');
        if (currentBubble) {
            const cursor = currentBubble.querySelector('.cursor');
            if (cursor) cursor.remove();
            if (isFinished) addCopyButton(currentBubble);
        }
        stopBtn.classList.add('hidden');
        sendBtn.classList.remove('hidden');
        micBtn.classList.remove('hidden');
    };
    
    const appendMessage = (text, type, isLoading = false) => {
        const bubble = document.createElement('div');
        bubble.className = `message-bubble ${type}`;
        if (isLoading) {
            bubble.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
        } else {
            bubble.textContent = text;
        }
        if (type === 'bot' && !isLoading) {
            addCopyButton(bubble);
        }
        messageArea.appendChild(bubble);
        messageArea.scrollTop = messageArea.scrollHeight;
        return bubble;
    };

    const updateLastBotMessage = (text, bubble) => {
        stopTyping();
        if (!bubble) return;
        bubble.innerHTML = '';
        let i = 0;
        const cursor = document.createElement('span');
        cursor.className = 'cursor';
        bubble.appendChild(cursor);
        stopBtn.classList.remove('hidden');
        sendBtn.classList.add('hidden');
        micBtn.classList.add('hidden');
        typingInterval = setInterval(() => {
            if (i < text.length) {
                cursor.before(text.charAt(i));
                i++;
                messageArea.scrollTop = messageArea.scrollHeight;
            } else {
                stopTyping(true, bubble);
            }
        }, 25);
    };

   const sendMessage = async () => {
    const question = chatInput.value.trim();
    if (!question || sendBtn.disabled) return;
    if (!hasChatStarted) {
        welcomeScreen.classList.add('hidden');
        hasChatStarted = true;
    }
    appendMessage(question, 'user');
    chatInput.value = '';
    sendBtn.classList.remove('sailed-away');
    sendBtn.classList.add('thinking');
    sendBtn.disabled = true;
    const botBubble = appendMessage('', 'bot', true);

    try {
        // âœ… Automatically detect environment (local or deployed)
        const API_URL =
            window.location.hostname === "localhost"
                ? "http://localhost:5000/api/chat"
                : "https://your-backend-name.onrender.com/api/chat"; // <-- change this after Render deploy

        const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ question })
        });

        if (!res.ok) throw new Error(`Server error: ${res.status}`);
        const data = await res.json();
        updateLastBotMessage(data.answer || "Sorry, I couldn't get a response.", botBubble);
    } catch (err) {
        console.error('Send message error', err);
        stopTyping();
        botBubble.textContent = `Error: ${err.message || 'Connection error'}.`;
        addCopyButton(botBubble);
    } finally {
        sendBtn.classList.remove('thinking');
        sendBtn.classList.add('sailed-away');
        setTimeout(() => {
            sendBtn.classList.remove('sailed-away');
            sendBtn.disabled = false;
        }, 1200);
    }
};

    
    menuToggle.addEventListener('click', (e) => { sideMenu.classList.toggle('open'); e.stopPropagation(); });
    document.addEventListener('click', (e) => {
        if (!sideMenu.contains(e.target) && !menuToggle.contains(e.target)) {
            sideMenu.classList.remove('open');
        }
    });

    themeToggle.addEventListener('click', () => {
        const isNight = chatContainer.classList.toggle('night-theme');
        localStorage.setItem('theme', isNight ? 'dark' : 'light');
    });

    promptContainer.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        chatInput.value = btn.textContent.trim();
        setTimeout(() => sendMessage(), 80);
    });

    sendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); sendMessage(); } });
    stopBtn.addEventListener('click', () => stopTyping(false));

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.interimResults = true;
        let finalTranscript = '';
        micBtn.addEventListener('click', () => {
            if (micBtn.classList.contains('listening')) {
                recognition.stop();
            } else {
                finalTranscript = '';
                chatInput.value = '';
                recognition.start();
            }
        });
        recognition.onstart = () => { micBtn.classList.add('listening'); micBtn.disabled = true; sendBtn.disabled = true; };
        recognition.onend = () => { micBtn.classList.remove('listening'); micBtn.disabled = false; sendBtn.disabled = false; };
        recognition.onerror = (e) => { console.error('Speech recognition error:', e.error); };
        recognition.onresult = (e) => {
            let interim = '';
            for (let i = e.resultIndex; i < e.results.length; ++i) {
                if (e.results[i].isFinal) finalTranscript += e.results[i][0].transcript;
                else interim += e.results[i][0].transcript;
            }
            chatInput.value = (finalTranscript + interim).trim();
        };
    } else {
        micBtn.style.display = 'none';
    }
    chatInput.focus();
});
</script>
</body>
</html> 

